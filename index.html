<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Asteroid Defense Game</title>
<style>
  :root {
    --bg:#0b1221; --card:#172135; --accent:#38bdf8; --danger:#ef4444; --muted:#94a3b8; --text:#e6eef8;
  }
  [data-theme="light"] {
    --bg:#f9fafb; --card:#ffffff; --accent:#2563eb; --danger:#dc2626; --muted:#6b7280; --text:#111827;
  }
  body { margin:0; background:var(--bg); color:var(--text); font-family:sans-serif; padding:16px; }
  .app { max-width:1000px; margin:auto; }
  .panel { background:var(--card); padding:16px; border-radius:12px; margin-bottom:12px; box-shadow:0 4px 10px rgba(0,0,0,0.2); }
  h1 { margin:0; }
  button { cursor:pointer; padding:8px 14px; border-radius:10px; border:0; margin:4px; font-weight:600; transition:transform 0.2s; }
  button:hover { transform:scale(1.08); }
  button.primary { background:var(--accent); color:white; }
  button.ghost { background:transparent; border:1px solid var(--muted); color:var(--text); }
  .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  label { display:block; margin-top:6px; font-size:14px; }
  input[type=number], input[type=range] { width:100%; margin:4px 0; }
  #results { overflow:hidden; max-height:40px; transition:max-height 0.6s ease; white-space:pre-wrap; }
  #results.show { max-height:400px; }
  .score { font-size:24px; font-weight:bold; color:var(--accent); margin-top:8px; }
  .anim-panel { position:relative; height:200px; background:radial-gradient(circle at center, #1e293b, #0f172a); border-radius:12px; overflow:hidden; }
  .meteor, .earth, .rocket { position:absolute; }
  .earth { bottom:10px; left:50%; transform:translateX(-50%); font-size:60px; }
  .meteor { top:-50px; left:10%; font-size:40px; opacity:0; transition:all 2s linear; }
  .rocket { top:120px; left:20%; font-size:30px; opacity:0; transition:all 1.5s linear; }
  .tip { font-size:13px; color:var(--muted); margin-top:6px; }
</style>
</head>
<body data-theme="dark">
<div class="app">
  <header class="panel row" style="justify-content:space-between;">
    <h1 id="title">🌍 Asteroid Defense Game</h1>
    <div class="row">
      <button id="themeBtn" class="ghost">🌙</button>
      <button id="langBtn" class="ghost">EN</button>
    </div>
  </header>

  <div class="panel">
    <div class="row">
      <button id="customBtn" class="primary">🌌 Create Your Own</button>
      <button id="historyBtn" class="ghost">☄️ Historical Impacts</button>
    </div>
    <div id="customInputs">
      <label id="diamLabel">Diameter (m)</label>
      <input type="number" id="diameter" value="100">
      <label id="velLabel">Velocity (km/s)</label>
      <input type="number" id="velocity" value="20">
      <label id="denLabel">Density (kg/m³)</label>
      <input type="number" id="density" value="3000">
      <label id="popLabel">Population density (/km²)</label>
      <input type="number" id="pop" value="1000">
    </div>
    <div id="historyList" style="display:none">
      <button data-preset="chelyabinsk">Chelyabinsk 2013</button>
      <button data-preset="tunguska">Tunguska 1908</button>
      <button data-preset="chicxulub">Chicxulub 66Mya</button>
    </div>
  </div>

  <div class="panel">
    <p id="strategyTitle">Select a mitigation strategy:</p>
    <div class="row">
      <button id="deflect">🚀 Deflect</button>
      <button id="fragment">💥 Fragment</button>
      <button id="evacuate">🏃 Evacuate</button>
    </div>
    <button id="launch" class="primary">▶️ Start Simulation</button>
    <p class="tip" id="tip">Tip: you can drag sliders or type numbers. Use the theme and language toggles (top-right).</p>
  </div>

  <div class="panel anim-panel">
    <div class="earth">🌍</div>
    <div class="meteor" id="meteor">☄️</div>
    <div class="rocket" id="rocket">🚀</div>
  </div>

  <div class="panel">
    <div id="results">No run yet</div>
    <div class="score" id="score">—</div>
  </div>
</div>

<script>
const PRESETS = {
  chelyabinsk:{diameter:20,velocity:19,density:3000,pop:4000},
  tunguska:{diameter:60,velocity:15,density:2700,pop:1},
  chicxulub:{diameter:10000,velocity:20,density:3000,pop:0}
};
let chosenStrategy=null; let lang="en";

// Physics
function kineticEnergyJ(d,dens,v){const r=d/2,vol=4/3*Math.PI*r**3,m=vol*dens;return 0.5*m*v*v;}
function joulesToMt(j){return j/4.184e15;}
function blastR(E){return 60*Math.pow(E/1e12,1/3);}
function casualties(R,pop){return Math.round(Math.PI*(R/1000)**2*pop*0.02);}

// Simulation
function runSim(){
  const d=+diameter.value, v=+velocity.value*1000, dens=+density.value, pop=+popInput.value;
  if(!chosenStrategy){alert(lang==="en"?"Choose strategy first":"اختر استراتيجية أولا");return;}
  const E=kineticEnergyJ(d,dens,v), mt=joulesToMt(E), R=blastR(E), cas=casualties(R,pop);
  let prevented=0;
  if(chosenStrategy==="deflect") prevented=cas*0.7;
  if(chosenStrategy==="fragment") prevented=cas*0.5;
  if(chosenStrategy==="evacuate") prevented=cas*0.4;
  animateImpact(chosenStrategy,()=> {
    results.classList.add("show");
    results.innerText=(lang==="en"?
     `Energy: ${mt.toFixed(2)} Mt\nBlast radius: ${Math.round(R)} m\nCasualties: ${cas}\nPrevented: ${Math.round(prevented)}`:
     `الطاقة: ${mt.toFixed(2)} ميغاطن\nنصف قطر الانفجار: ${Math.round(R)} م\nالضحايا: ${cas}\nالمُنقَذون: ${Math.round(prevented)}`);
    score.innerText=Math.round(prevented/(cas+1)*100)+"%";
  });
}

// Animations
function animateImpact(strategy,callback){
  const meteor=document.getElementById("meteor"), rocket=document.getElementById("rocket");
  meteor.style.top="-50px"; meteor.style.left="10%"; meteor.style.opacity=1;
  rocket.style.opacity=0;
  setTimeout(()=>{
    meteor.style.top="120px"; meteor.style.left="50%";
  },50);
  if(strategy==="deflect"){
    setTimeout(()=>{ rocket.style.opacity=1; rocket.style.left="30%"; rocket.style.top="50px"; },300);
    setTimeout(()=>{ meteor.style.left="90%"; meteor.style.top="300px"; meteor.style.opacity=0; },1200);
  }
  if(strategy==="fragment"){
    setTimeout(()=>{ meteor.innerText="💥"; meteor.style.fontSize="20px"; },1200);
  }
  if(strategy==="evacuate"){
    setTimeout(()=>{ meteor.style.top="160px"; },1500);
  }
  setTimeout(()=>{callback();meteor.innerText="☄️";meteor.style.opacity=0;rocket.style.opacity=0;},2200);
}

// Buttons
const popInput=document.getElementById("pop");
document.getElementById("deflect").onclick=()=>chosenStrategy="deflect";
document.getElementById("fragment").onclick=()=>chosenStrategy="fragment";
document.getElementById("evacuate").onclick=()=>chosenStrategy="evacuate";
document.getElementById("launch").onclick=runSim;
document.getElementById("customBtn").onclick=()=>{customInputs.style.display="block";historyList.style.display="none";};
document.getElementById("historyBtn").onclick=()=>{customInputs.style.display="none";historyList.style.display="block";};
document.querySelectorAll("#historyList button").forEach(btn=>{
  btn.onclick=()=>{let p=PRESETS[btn.dataset.preset];diameter.value=p.diameter;velocity.value=p.velocity;density.value=p.density;popInput.value=p.pop;};
});

// Theme toggle
document.getElementById("themeBtn").onclick=()=>{
  const body=document.body;
  body.dataset.theme=body.dataset.theme==="light"?"dark":"light";
};

// Language toggle
document.getElementById("langBtn").onclick=()=>{
  lang=lang==="en"?"ar":"en";
  langBtn.innerText=lang.toUpperCase();
  if(lang==="ar"){
    title.innerText="🌍 لعبة الدفاع عن الأرض";
    customBtn.innerText="🌌 أنشئ كويكبك الخاص";
    historyBtn.innerText="☄️ اصطدامات تاريخية";
    diamLabel.innerText="القطر (م)"; velLabel.innerText="السرعة (كم/ث)"; denLabel.innerText="الكثافة (كغ/م³)"; popLabel.innerText="الكثافة السكانية (/كم²)";
    strategyTitle.innerText="اختر استراتيجية التخفيف:"; 
    deflect.innerText="🚀 انحراف"; fragment.innerText="💥 تفتيت"; evacuate.innerText="🏃 إخلاء";
    launch.innerText="▶️ بدء المحاكاة"; tip.innerText="💡 ملاحظة: يمكنك سحب المنزلقات أو كتابة الأرقام. استخدم أزرار السمة واللغة (أعلى اليمين).";
  } else {
    title.innerText="🌍 Asteroid Defense Game";
    customBtn.innerText="🌌 Create Your Own";
    historyBtn.innerText="☄️ Historical Impacts";
    diamLabel.innerText="Diameter (m)"; velLabel.innerText="Velocity (km/s)"; denLabel.innerText="Density (kg/m³)"; popLabel.innerText="Population density (/km²)";
    strategyTitle.innerText="Select a mitigation strategy:"; 
    deflect.innerText="🚀 Deflect"; fragment.innerText="💥 Fragment"; evacuate.innerText="🏃 Evacuate";
    launch.innerText="▶️ Start Simulation"; tip.innerText="Tip: you can drag sliders or type numbers. Use the theme and language toggles (top-right).";
  }
};
</script>
</body>
</html>
