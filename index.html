<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asteroid Defense Game</title>
  <style>
    :root{
      --bg:#071024;--card:#0f1724;--accent:#38bdf8;--danger:#fb7185;--muted:#94a3b8;--text:#e6eef8;
    }
    [data-theme="light"] {
      --bg:#f3f4f6;--card:#ffffff;--accent:#2563eb;--danger:#dc2626;--muted:#6b7280;--text:#111827;
    }
    body{background:var(--bg);color:var(--text);margin:0;font-family:sans-serif;display:flex;align-items:center;justify-content:center;padding:16px}
    .app{width:100%;max-width:1000px}
    .panel{background:var(--card);padding:14px;border-radius:12px;margin-bottom:12px}
    button{cursor:pointer;padding:8px 12px;border-radius:10px;border:0;margin:4px;font-weight:600}
    button.primary{background:var(--accent);color:white}
    button.ghost{background:transparent;border:1px solid var(--muted);color:var(--text)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .small{font-size:13px;color:var(--muted)}
    .score{font-size:24px;font-weight:bold;color:var(--accent)}
  </style>
</head>
<body data-theme="dark">
  <div class="app">
    <header class="panel">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h1 id="title">🌍 Asteroid Defense Game</h1>
        <div class="row">
          <button id="themeBtn" class="ghost">🌙</button>
          <button id="langBtn" class="ghost">EN</button>
        </div>
      </div>
    </header>

    <div class="panel">
      <div class="row">
        <button id="customBtn" class="primary">🌌 Create Your Own</button>
        <button id="historyBtn" class="ghost">☄️ Historical Impacts</button>
      </div>
      <div id="customInputs">
        <label id="diamLabel">Diameter (m)</label>
        <input type="number" id="diameter" value="100">
        <label id="velLabel">Velocity (km/s)</label>
        <input type="number" id="velocity" value="20">
        <label id="denLabel">Density (kg/m³)</label>
        <input type="number" id="density" value="3000">
        <label id="popLabel">Population density (/km²)</label>
        <input type="number" id="pop" value="1000">
      </div>
      <div id="historyList" style="display:none">
        <button data-preset="chelyabinsk">Chelyabinsk 2013</button>
        <button data-preset="tunguska">Tunguska 1908</button>
        <button data-preset="chicxulub">Chicxulub 66Mya</button>
      </div>
    </div>

    <div class="panel">
      <div class="row">
        <button id="deflect">🚀 Deflect</button>
        <button id="fragment">💥 Fragment</button>
        <button id="evacuate">🏃 Evacuate</button>
      </div>
      <button id="launch" class="primary">▶️ Simulate</button>
    </div>

    <div class="panel">
      <div id="results">No run yet</div>
      <div class="score" id="score">—</div>
    </div>
  </div>

<script>
const PRESETS = {
  chelyabinsk:{diameter:20,velocity:19,density:3000,pop:4000},
  tunguska:{diameter:60,velocity:15,density:2700,pop:1},
  chicxulub:{diameter:10000,velocity:20,density:3000,pop:0}
};
let chosenStrategy=null;
let lang="en";

// Physics
function kineticEnergyJ(d,dens,v){const r=d/2,vol=4/3*Math.PI*r**3,m=vol*dens;return 0.5*m*v*v;}
function joulesToMt(j){return j/4.184e15;}
function blastR(E){return 60*Math.pow(E/1e12,1/3);}
function casualties(R,pop){return Math.round(Math.PI*(R/1000)**2*pop*0.02);}

// Simulation
function runSim(){
  const d=+document.getElementById("diameter").value;
  const v=+document.getElementById("velocity").value*1000;
  const dens=+document.getElementById("density").value;
  const pop=+document.getElementById("pop").value;
  if(!chosenStrategy){alert("Choose strategy first");return;}
  const E=kineticEnergyJ(d,dens,v);
  const mt=joulesToMt(E);
  const R=blastR(E);
  const cas=casualties(R,pop);
  let prevented=0;
  if(chosenStrategy==="deflect") prevented=cas*0.7;
  if(chosenStrategy==="fragment") prevented=cas*0.5;
  if(chosenStrategy==="evacuate") prevented=cas*0.4;
  const score=Math.round(prevented/(cas+1)*100);
  document.getElementById("results").innerText=
    (lang==="en"?
     `Energy: ${mt.toFixed(2)} Mt, Blast radius: ${Math.round(R)} m, Casualties: ${cas}, Prevented: ${Math.round(prevented)}`:
     `الطاقة: ${mt.toFixed(2)} ميغاطن، نصف قطر الانفجار: ${Math.round(R)} م، الضحايا: ${cas}، المُنقَذون: ${Math.round(prevented)}`);
  document.getElementById("score").innerText=score+"%";
}

// Buttons
document.getElementById("deflect").onclick=()=>chosenStrategy="deflect";
document.getElementById("fragment").onclick=()=>chosenStrategy="fragment";
document.getElementById("evacuate").onclick=()=>chosenStrategy="evacuate";
document.getElementById("launch").onclick=runSim;

document.getElementById("customBtn").onclick=()=>{
  document.getElementById("customInputs").style.display="block";
  document.getElementById("historyList").style.display="none";
};
document.getElementById("historyBtn").onclick=()=>{
  document.getElementById("customInputs").style.display="none";
  document.getElementById("historyList").style.display="block";
};
document.querySelectorAll("#historyList button").forEach(btn=>{
  btn.onclick=()=>{
    const p=PRESETS[btn.dataset.preset];
    diameter.value=p.diameter;velocity.value=p.velocity;density.value=p.density;pop.value=p.pop;
  };
});

// Theme toggle
document.getElementById("themeBtn").onclick=()=>{
  const body=document.body;
  body.dataset.theme=body.dataset.theme==="light"?"dark":"light";
};

// Language toggle
document.getElementById("langBtn").onclick=()=>{
  lang=lang==="en"?"ar":"en";
  document.getElementById("langBtn").innerText=lang.toUpperCase();
  if(lang==="ar"){
    document.getElementById("title").innerText="🌍 لعبة الدفاع عن الأرض";
    diamLabel.innerText="القطر (م)";
    velLabel.innerText="السرعة (كم/ث)";
    denLabel.innerText="الكثافة (كغ/م³)";
    popLabel.innerText="الكثافة السكانية (/كم²)";
    document.getElementById("launch").innerText="▶️ محاكاة";
  }else{
    document.getElementById("title").innerText="🌍 Asteroid Defense Game";
    diamLabel.innerText="Diameter (m)";
    velLabel.innerText="Velocity (km/s)";
    denLabel.innerText="Density (kg/m³)";
    popLabel.innerText="Population density (/km²)";
    document.getElementById("launch").innerText="▶️ Simulate";
  }
};
</script>
</body>
</html>
