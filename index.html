<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Asteroid Impact Simulator</title>
  <style>
    :root {
      --bg: #111;
      --fg: #eee;
      --accent: #4cafef;
    }
    [data-theme="light"] {
      --bg: #f8f8f8;
      --fg: #111;
      --accent: #0077cc;
    }
    body {
      background: var(--bg);
      color: var(--fg);
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      transition: background 0.5s, color 0.5s;
    }
    header {
      display: flex;
      justify-content: space-between;
      padding: 1em;
      background: rgba(0,0,0,0.2);
    }
    button {
      padding: 0.5em 1em;
      border: none;
      margin: 0.2em;
      border-radius: 8px;
      background: var(--accent);
      color: white;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover { transform: scale(1.05); }
    h1 { text-align: center; }
    .panel {
      max-width: 800px;
      margin: 1em auto;
      padding: 1em;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
    }
    .results {
      overflow: hidden;
      transition: max-height 0.6s ease, padding 0.6s ease;
      max-height: 0;
      padding: 0 1em;
      white-space: pre-line;
    }
    .results.show {
      max-height: 500px;
      padding: 1em;
    }
    .anim-area {
      position: relative;
      height: 200px;
      margin: 1em 0;
      background: radial-gradient(circle at center, #223 30%, #112 100%);
      border-radius: 12px;
      overflow: hidden;
    }
    .earth {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: blue;
      box-shadow: 0 0 20px rgba(0,0,255,0.7);
    }
    .meteor {
      position: absolute;
      top: -40px;
      left: -40px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: orange;
      box-shadow: 0 0 20px rgba(255,140,0,0.9);
    }
    .explosion {
      position: absolute;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: radial-gradient(circle, yellow, red, transparent);
      opacity: 0;
      pointer-events: none;
    }
    .tip {
      font-size: 0.9em;
      opacity: 0.7;
      margin-top: 1em;
    }
  </style>
</head>
<body data-theme="dark">
  <header>
    <div>
      <button id="themeBtn">üåô</button>
      <button id="langBtn">AR</button>
    </div>
  </header>

  <h1 id="title">üåç Asteroid Impact Simulator</h1>

  <div class="panel">
    <button id="customBtn">üåå Create Your Own Meteor</button>
    <button id="historyBtn">‚òÑÔ∏è Historical Impacts</button>

    <div id="customPanel" style="display:none; margin-top:1em;">
      <label>Diameter (m): <input type="number" id="diameter" value="100"></label><br>
      <label>Velocity (km/s): <input type="number" id="velocity" value="20"></label><br>
      <label>Density (kg/m¬≥): <input type="number" id="density" value="3000"></label><br>
      <label>Population Density (per km¬≤): <input type="number" id="popdensity" value="1000"></label><br>
    </div>

    <div id="historyPanel" style="display:none; margin-top:1em;">
      <button data-d="20" data-v="19" data-rho="3300" data-pop="1000">Chelyabinsk 2013</button>
      <button data-d="50" data-v="27" data-rho="3000" data-pop="5">Tunguska 1908</button>
      <button data-d="10000" data-v="20" data-rho="2500" data-pop="50">Chicxulub 66Mya</button>
    </div>
  </div>

  <div class="panel">
    <h3 id="strategyTitle">Select a mitigation strategy</h3>
    <button class="stratBtn" data-strat="deflect">Deflect</button>
    <button class="stratBtn" data-strat="fragment">Fragment</button>
    <button class="stratBtn" data-strat="evacuate">Evacuate</button>
  </div>

  <div class="panel anim-area">
    <div class="earth"></div>
    <div id="meteor" class="meteor"></div>
    <div id="explosion" class="explosion"></div>
  </div>

  <div class="panel results" id="results"></div>
  <p class="tip" id="tip">
    Tip: you can drag sliders or type numbers. Use the theme and language toggles (top-right).
  </p>

  <script>
    // Dictionaries for EN/AR
    const dict = {
      en: {
        title: "üåç Asteroid Impact Simulator",
        custom: "üåå Create Your Own Meteor",
        history: "‚òÑÔ∏è Historical Impacts",
        strategyTitle: "Select a mitigation strategy",
        strat: { deflect: "Deflect", fragment: "Fragment", evacuate: "Evacuate" },
        tip: "Tip: you can drag sliders or type numbers. Use the theme and language toggles (top-right).",
        results: (mt,R,cas,prev) =>
          `Energy: ${mt.toFixed(2)} Mt TNT\nBlast radius: ${Math.round(R)} m\nCasualties: ${cas}\nPrevented: ${Math.round(prev)}`
      },
      ar: {
        title: "üåç ŸÖÿ≠ÿßŸÉŸä ÿßÿµÿ∑ÿØÿßŸÖ ÿßŸÑŸÉŸàŸäŸÉÿ®",
        custom: "üåå ÿ£ŸÜÿ¥ÿ¶ ŸÉŸàŸäŸÉÿ®ŸÉ ÿßŸÑÿÆÿßÿµ",
        history: "‚òÑÔ∏è ÿßÿµÿ∑ÿØÿßŸÖÿßÿ™ ÿ™ÿßÿ±ŸäÿÆŸäÿ©",
        strategyTitle: "ÿßÿÆÿ™ÿ± ÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿ© ÿßŸÑÿ™ÿÆŸÅŸäŸÅ",
        strat: { deflect: "ÿßŸÜÿ≠ÿ±ÿßŸÅ", fragment: "ÿ™ŸÅÿ™Ÿäÿ™", evacuate: "ÿ•ÿÆŸÑÿßÿ°" },
        tip: "üí° ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ŸäŸÖŸÉŸÜŸÉ ÿ≥ÿ≠ÿ® ÿßŸÑŸÖŸÜÿ≤ŸÑŸÇÿßÿ™ ÿ£Ÿà ŸÉÿ™ÿßÿ®ÿ© ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ. ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ≥ŸÖÿ© ŸàÿßŸÑŸÑÿ∫ÿ© (ÿ£ÿπŸÑŸâ ÿßŸÑŸäŸÖŸäŸÜ).",
        results: (mt,R,cas,prev) =>
          `ÿßŸÑÿ∑ÿßŸÇÿ©: ${mt.toFixed(2)} ŸÖŸäÿ∫ÿßÿ∑ŸÜ\nŸÜÿµŸÅ ŸÇÿ∑ÿ± ÿßŸÑÿßŸÜŸÅÿ¨ÿßÿ±: ${Math.round(R)} ŸÖ\nÿßŸÑÿ∂ÿ≠ÿßŸäÿß: ${cas}\nÿßŸÑŸÖŸèŸÜŸÇŸéÿ∞ŸàŸÜ: ${Math.round(prev)}`
      }
    };

    let lang = "en";
    let selectedAsteroid = { d:100, v:20, rho:3000, pop:1000 };

    const resultsDiv = document.getElementById("results");
    const meteorEl = document.getElementById("meteor");
    const explosionEl = document.getElementById("explosion");

    function kineticEnergy(d,rho,v){
      const r = d/2;
      const vol = (4/3)*Math.PI*Math.pow(r,3);
      const m = vol*rho;
      return 0.5*m*v*v;
    }
    function joulesToMt(E){ return E/4.184e15; }
    function blastRadius(E){ return 60*Math.pow(E/1e12,1/3); }
    function casualties(R,pop){ return Math.round(Math.PI*Math.pow(R/1000,2)*pop*0.02); }

    function runSimulation(strat){
      // Animate meteor
      meteorEl.style.transition = "none";
      meteorEl.style.top = "-40px"; meteorEl.style.left = "-40px";
      setTimeout(()=>{
        meteorEl.style.transition = "top 2s linear, left 2s linear";
        meteorEl.style.top = "120px"; meteorEl.style.left = "calc(50% - 20px)";
      },50);

      meteorEl.addEventListener("transitionend", ()=>{
        if(strat==="deflect"){
          meteorEl.style.transition = "top 1.5s linear, left 1.5s linear";
          meteorEl.style.left = "100%"; meteorEl.style.top = "50px";
          showResults(strat);
        } else if(strat==="fragment"){
          explosionEl.style.left = "calc(50% - 50px)";
          explosionEl.style.top = "60px";
          explosionEl.style.opacity = 1;
          setTimeout(()=>explosionEl.style.opacity=0,1000);
          meteorEl.style.opacity=0;
          showResults(strat);
        } else {
          explosionEl.style.left = "calc(50% - 50px)";
          explosionEl.style.top = "100px";
          explosionEl.style.opacity = 1;
          setTimeout(()=>explosionEl.style.opacity=0,1000);
          meteorEl.style.opacity=0;
          showResults(strat);
        }
      }, {once:true});
    }

    function showResults(strat){
      const d=selectedAsteroid.d, v=selectedAsteroid.v*1000, rho=selectedAsteroid.rho, pop=selectedAsteroid.pop;
      const E=kineticEnergy(d,rho,v);
      const mt=joulesToMt(E), R=blastRadius(E), cas=casualties(R,pop);
      let prevented=0;
      if(strat==="deflect") prevented=cas*0.7;
      if(strat==="fragment") prevented=cas*0.5;
      if(strat==="evacuate") prevented=cas*0.4;
      resultsDiv.innerText=dict[lang].results(mt,R,cas,prevented);
      resultsDiv.classList.add("show");
    }

    // UI bindings
    document.getElementById("customBtn").onclick=()=>{
      document.getElementById("customPanel").style.display="block";
      document.getElementById("historyPanel").style.display="none";
    };
    document.getElementById("historyBtn").onclick=()=>{
      document.getElementById("customPanel").style.display="none";
      document.getElementById("historyPanel").style.display="block";
    };
    document.querySelectorAll("#historyPanel button").forEach(btn=>{
      btn.onclick=()=>{
        selectedAsteroid={
          d:+btn.dataset.d,
          v:+btn.dataset.v,
          rho:+btn.dataset.rho,
          pop:+btn.dataset.pop
        };
      };
    });
    document.querySelectorAll(".stratBtn").forEach(btn=>{
      btn.onclick=()=>{
        // update selectedAsteroid if from custom inputs
        if(document.getElementById("customPanel").style.display==="block"){
          selectedAsteroid={
            d:+document.getElementById("diameter").value,
            v:+document.getElementById("velocity").value,
            rho:+document.getElementById("density").value,
            pop:+document.getElementById("popdensity").value
          };
        }
        meteorEl.style.opacity=1;
        runSimulation(btn.dataset.strat);
      };
    });

    // Theme & lang
    document.getElementById("themeBtn").onclick=()=>{
      const body=document.body;
      const dark=body.getAttribute("data-theme")==="dark";
      body.setAttribute("data-theme",dark?"light":"dark");
    };
    document.getElementById("langBtn").onclick=()=>{
      lang=(lang==="en"?"ar":"en");
      applyLang();
    };

    function applyLang(){
      document.getElementById("title").innerText=dict[lang].title;
      document.getElementById("customBtn").innerText=dict[lang].custom;
      document.getElementById("historyBtn").innerText=dict[lang].history;
      document.getElementById("strategyTitle").innerText=dict[lang].strategyTitle;
      document.querySelectorAll(".stratBtn").forEach(btn=>{
        btn.innerText=dict[lang].strat[btn.dataset.strat];
      });
      document.getElementById("tip").innerText=dict[lang].tip;
      // re-render results if visible
      if(resultsDiv.classList.contains("show")){
        const text=resultsDiv.innerText;
        // We can just re-run simulation with last data
        resultsDiv.innerText=""; // clear
        setTimeout(()=>showResults("last"),10);
      }
    }
  </script>
</body>
</html>
